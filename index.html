<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <title>Formula 1 Driver Analyzer</title>
        <script type="text/javascript" src="d3.js" charset="utf-8"></script>
        <style>
            #abovewrapper {
                width: fit-content;
                display: flex;
            }
            #title {
                border: 3px solid black;
                padding-left: 5px;
                padding-right: 5px;
                padding-bottom: 5px;
                display: inline-block;
                background: yellow;
                text-align: center;
                animation-name: fadeInOpacity;
                animation-iteration-count: 1;
                animation-timing-function: ease-in;
                animation-duration: 2s;
            }
            
            @keyframes fadeInOpacity {
                0% {
                    opacity: 0;
                }
                100% {
                    opacity: 1;
                }
            }
        </style>
	</head>
    
    <body>
    <script charset="utf-8"> 
    class Driver {
        surname;
        name;
        concatName;

        constructor(surname, name) {
            this.surname = surname;
            this.name = name;
            this.concatName = surname + " " + name;
        }
    }
    
    showActiveDrivers = true; // Flag that indicates to show only active drivers
    activeDrivers = []; // List of drivers loaded by the data that are active
    retiredDrivers = []; // List of drivers loaded by the data that are retired
    
    function contains(drivers, driver) {
        for (i = 0; i < drivers.length; i++) {
            currentDriver = drivers[i];
            if (drivers[i].name == driver.name && drivers[i].surname == driver.surname) {
                return i+1; 
            }
        }
        return 0;
    }
    
    function drawTitle() {
        // Creates the wrapper div that contains the div 'title'
        aboveWrapper = document.createElement('div');
        aboveWrapper.id = "abovewrapper";
        document.body.appendChild(aboveWrapper);
        
        // Creates the div 'title' which contains text, selections and buttons
        title = document.createElement('div');
        title.id = "title";
        title.innerHTML = "<h1>Formula 1 Driver Analyzer</h1>";
        
        // Adds radios button in order to distinguish between active and retired drivers
        title.innerHTML += "Choose between drivers that are: ";
        activeButton = document.createElement('input');
        activeButton.type = 'radio';
        activeButton.name = 'drivers';
        activeButton.id = 'active-drivers';
        activeButton.value = "active";
        label = document.createElement('label');
        label.innerHTML = "Active";
        title.appendChild(activeButton);
        title.appendChild(label);
        title.innerHTML += "   ";
        
        retiredButton = document.createElement('input');
        retiredButton.type = 'radio';
        retiredButton.name = 'drivers';
        retiredButton.id = 'retired-drivers';
        retiredButton.value = "retired";
        label = document.createElement('label');
        label.innerHTML = "Retired";
        title.appendChild(retiredButton);
        title.appendChild(label);
        title.innerHTML += "<br>";
        
        // Creates a selection for the drivers with a default option, and adds it to 'title'
        title.innerHTML += "Please select a driver: ";
        aboveWrapper.appendChild(title);   
        selectDriver = document.createElement('select');
        selectDriver.id = "select-driver";
        defaultDriverOption = document.createElement('option');
        defaultDriverOption.value = 0;
        defaultDriverOption.innerHTML = "- DRIVER -";
        selectDriver.appendChild(defaultDriverOption);
        title.appendChild(selectDriver);
        title.innerHTML += "<br>";
        
         // Creates the search button, makes it disabled and adds it to 'title'
        search = document.createElement('button');
        search.id = "search";
        search.innerHTML = "Search data!";
        search.disabled = true;
        title.appendChild(search);
        
        document.getElementById("active-drivers").checked = true; 
        loadData();
    }
    
    // Loads the data from the csv file
    function loadData() {
        d3.csv("results.csv", function(error, data) {
            // Prints the error in case something goes wrong
            if (error) {
                console.log(error);
            }
            // Everything goes ok!
            else {
                activeDrivers = []; // Will Contain all active drivers inside the csv file
                retiredDrivers = []; // Will contain all retired drivers inside the csv file
                data.forEach(function(d) { // Cycles through the data
                    driver = new Driver(d.surname, d.name);
                    if (d.year == 2019 && !contains(activeDrivers, driver)) {
                        activeDrivers.push(driver);
                        index = contains(retiredDrivers, driver);
                        if (index) {
                            retiredDrivers.splice(index-1, 1);
                        }
                    }
                    else if (!contains(retiredDrivers, driver) && !contains(activeDrivers, driver)) {
                        retiredDrivers.push(driver);
                    }
                });
             
                console.log(activeDrivers);
                console.log(retiredDrivers);
                addDriversToTitle(); // Adds the events to the user's selections in the title now that the data is loaded
                enableInputsToTitle(data);
            }
        });
    }
    
    // Adds the correct list of drivers to the selection
    function addDriversToTitle() {
        if (showActiveDrivers) {
            for (i = 0; i < activeDrivers.length; i++) {
                newDriverOption = document.createElement('option'); // Makes the new season a selectable option 
                newDriverOption.value = i+1;
                newDriverOption.innerHTML = activeDrivers[i].concatName;
                document.getElementById("select-driver").appendChild(newDriverOption);
            }
        }
        else {
            for (i = 0; i < retiredDrivers.length; i++) {
                newDriverOption = document.createElement('option'); // Makes the new season a selectable option 
                newDriverOption.value = i+1;
                newDriverOption.innerHTML = retiredDrivers[i].concatName;
                document.getElementById("select-driver").appendChild(newDriverOption);
            }
        }
    }
    
    // Adds events to the interactions of the user with the title screen
    function enableInputsToTitle(data) {
        document.getElementById("active-drivers").onclick = function() {
            showActiveDrivers = true;
            document.getElementById("search").disabled = true; // Disables the search button
            document.getElementById("select-driver").value = 0; // Restore the driver selector to the default option
            options = document.getElementById("select-driver").options.length; // Removes all options inside the selector bar the default one
            for (i = options-1; i > 0; i--) {
                document.getElementById("select-driver").options[i] = null;
            }
            addDriversToTitle();
        }
        document.getElementById("retired-drivers").onclick = function() {
            showActiveDrivers = false;
            document.getElementById("search").disabled = true; // Disables the search button
            document.getElementById("select-driver").value = 0; // Restore the driver selector to the default option
            options = document.getElementById("select-driver").options.length; // Removes all options inside the selector bar the default one
            for (i = options-1; i > 0; i--) {
                document.getElementById("select-driver").options[i] = null;
            }
            addDriversToTitle();
        }
        document.getElementById("select-driver").onchange = function() { 
            if (document.getElementById("select-driver").value > 0) {  // A valid driver is selected: enables search button
                document.getElementById("search").disabled = false;
            }
            else { // Default option selected: disables search button
                document.getElementById("search").disabled = true;
            }
        }
        search.onclick = function() { // Checks if the user clicks the search button
            value = document.getElementById("select-driver").value;
            if (showActiveDrivers) {
                surname = activeDrivers[value-1].surname;
                name = activeDrivers[value-1].name;
                alert("I've selected " + surname + " " + name + "!");
            }
            else {
                surname = retiredDrivers[value-1].surname;
                name = retiredDrivers[value-1].name;
                alert("I've selected " + surname + " " + name + "!");
            }
        }    
    }
                       
    drawTitle();
    </script>
    </body>
</html>